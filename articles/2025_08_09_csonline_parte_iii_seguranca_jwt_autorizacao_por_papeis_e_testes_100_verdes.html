<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Csonline – Parte Iii - Segurança Jwt Autorização Por Papéis E Testes 100 Verdes - Christian Mulato Dev Blog</title>
    <meta name="description" content="Artigo sobre Csonline – Parte Iii - Segurança Jwt Autorização Por Papéis E Testes 100 Verdes">
    <meta name="author" content="Christian Mulato">
    <meta name="keywords" content="Java, Desenvolvimento, Tecnologia">
    
    <!-- CSS -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/article.css">
    <link rel="stylesheet" href="assets/css/highlight.css">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <h1><a href="index.html">Christian Mulato Dev Blog</a></h1>
            <nav class="main-nav">
                <a href="index.html">Início</a>
                <a href="#sobre">Sobre</a>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <article class="post">
                <header class="post-header">
                    <h1 class="post-title">Csonline – Parte Iii - Segurança Jwt Autorização Por Papéis E Testes 100 Verdes</h1>
                    <div class="post-meta">
                        <time datetime="2025-08-09">09/08/2025</time>
                        <span class="post-author">Por Christian Mulato</span>
                    </div>
                    
                </header>
                
                <div class="post-content">
                    <p><img alt="Evolução da aplicação CSOnline - Gestão de Centro de Distribuição (CDs)" src="assets/img/2025_08_09_IMAGE_001.png" /></p>
<p>Evolução da aplicação CSOnline - Gestão de Centro de Distribuição (CDs)</p>
<p><strong>CSOnline -- Parte III: Segurança JWT, Autorização por Papéis e Testes 100% Verdes</strong></p>
<p><strong>O que evoluiu nesta fase</strong></p>
<p>Nesta terceira etapa avançamos em segurança, qualidade e preparo para a integração total do <strong><em>frontend</em> Vue</strong> com o <strong><em>backend</em> Jakarta EE</strong>. O sistema agora possui autenticação JWT robusta, autorização por papéis coerente nos endpoints, suíte de testes completa e scripts de desenvolvimento mais amigáveis.</p>
<p>Principais destaques:</p>
<ul>
<li>
<p>Segurança ponta a ponta com <strong>JWT</strong> (autenticação) e autorização por papéis (@RolesAllowed)</p>
</li>
<li>
<p>Matriz de permissões alinhada aos casos de uso reais (<strong>ADMIN, BUSINESS, COURIER, CUSTOMER</strong>)</p>
</li>
<li>
<p>Testes de controladores, serviços e repositórios estabilizados (<strong>191 testes passando</strong>)</p>
</li>
<li>
<p>Ambiente de testes isolado (test.mode), base limpa por execução e Jackson registrado</p>
</li>
<li>
<p>Endpoint de envio de SMS dedicado e ajustes finos em regras de acesso</p>
</li>
<li>
<p>Prontos para integrar o SPA em <strong>Vue</strong> com os endpoints REST e tokens JWT</p>
</li>
</ul>
<hr />
<p><strong>Segurança: autenticação e autorização</strong></p>
<ul>
<li>
<p>Implementamos um filtro de autenticação JWT (<strong><em>JwtAuthenticationFilter</em></strong>) que valida o token do header Authorization e propaga para o contexto os dados do usuário (login, role, id).</p>
</li>
<li>
<p>Criamos um filtro de autorização (<strong><em>AuthorizationFilter</em></strong>) que lê as anotações @RolesAllowed nos recursos e aplica a decisão com base no papel do usuário autenticado.</p>
</li>
<li>
<p>Ajustamos as anotações de segurança nos controladores para refletir a regra de negócio:</p>
</li>
</ul>
<hr />
<ol>
<li>
<p><strong>Users:</strong> criação, atualização e exclusão restritas a ADMIN</p>
</li>
<li>
<p><strong>Teams:</strong> atualização e exclusão restritas a ADMIN</p>
</li>
<li>
<p><strong>Prices:</strong> listagem por business permitida a ADMIN e BUSINESS</p>
</li>
<li>
<p><strong>SMS:</strong> deleção e busca por entrega restritas a ADMIN e BUSINESS; novo POST /sms/{id}/send</p>
</li>
</ol>
<hr />
<p><strong>Resultado:</strong> respostas 401 e 403 passaram a refletir corretamente a ausência de token ou falta de permissão, e as operações válidas retornam 2xx como esperado.</p>
<hr />
<p><strong>Testes: cobertura confiável do backend</strong></p>
<ul>
<li>
<p><em>BaseControllerJerseyTest</em> ativa o modo de teste (test.mode) e garante limpeza da base entre cenários, evitando interferência entre casos.</p>
</li>
<li>
<p>Reescrevemos e ampliamos os testes dos módulos Price (repository/service/controller), além de padronizar os de Courier, Customer, Delivery, SMS, Team e User para sempre enviar os headers de autorização corretos.</p>
</li>
<li>
<p>Resolvemos falhas pontuais (401/403/415/400/500) com ajustes em headers, content-type e alinhamento de payloads.</p>
</li>
<li>
<p>Estado atual: 191 testes, todos passando, garantindo estabilidade para a próxima fase.</p>
</li>
</ul>
<hr />
<p><strong>DX e automação</strong></p>
<ul>
<li>
<p>Scripts PowerShell simplificam o ciclo de desenvolvimento (build, deploy no <strong>WildFly 31</strong>, testes e verificação de saúde).</p>
</li>
<li>
<p>Logs mais claros com <strong>Log4j2</strong> ajudam no diagnóstico durante os testes.</p>
</li>
<li>
<p>Documentação atualizada para orientar a configuração de ambiente e execução.</p>
</li>
</ul>
<hr />
<p><strong>Integração Frontend (Vue) ↔ Backend (Jakarta)</strong></p>
<p>Com a segurança e os contratos estabilizados, o próximo passo é ligar o <strong>SPA</strong> em <strong>Vue</strong> aos endpoints REST com JWT:</p>
<ul>
<li>
<p>Cliente HTTP com injeção automática do token JWT</p>
</li>
<li>
<p>Tratamento padronizado de erros 401/403 no frontend (ex.: redireciono ao login/avisos de permissão)</p>
</li>
<li>
<p>Guards de rota por papel (ADMIN, BUSINESS, COURIER, CUSTOMER)</p>
</li>
<li>
<p>Habilitar CORS conforme necessário e mapear escopos de cada módulo (Users, Teams, Deliveries, SMS, Prices)</p>
</li>
</ul>
<hr />
<p><strong>Como contribuir</strong></p>
<ul>
<li>
<p><strong>Frontend:</strong> integrar telas ao <em>backend</em>, melhorar UX/UI, criar guards por papel, estados vazios e feedbacks.</p>
</li>
<li>
<p><strong>Backend:</strong> refinar validações, paginação/ordenação de listagens, monitoramento e métricas.</p>
</li>
<li>
<p><strong>QA:</strong> cenários E2E (Cypress/Playwright) para fluxos críticos de autenticação e autorização.</p>
</li>
<li>
<p><strong>DevOps:</strong> pipelines de CI/CD e empacotamento para ambientes (<strong>dev/homolog/prod</strong>).</p>
</li>
</ul>
<p>Faça um fork do repositório em <a href="https://github.com/chmulato/csonline"><strong>https://github.com/chmulato/csonline</strong></a> e confira a documentação em <strong>doc/INDEX.md</strong>. Pull Requests são bem-vindos!</p>
                </div>
                
                <footer class="post-footer">
                    <div class="author-info">
                        <img src="assets/img/foto_chri.jpg" alt="Christian Mulato" class="author-avatar">
                        <div class="author-details">
                            <strong>Christian Mulato</strong>
                            <p>Desenvolvedor Java e Arquiteto de Software</p>
                        </div>
                    </div>
                </footer>
            </article>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2025 Christian Mulato. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="assets/js/main.js"></script>
</body>
</html>