<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Artigo técnico sobre csonline – parte iii - segurança jwt autorização por papéis e testes 100 verdes">
    <meta name="author" content="Christian Mulato">
    <meta name="keywords" content="Java, Spring, Docker, APIs, Testes, DevOps">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://chmulato.dev/articles/2025_08_09_csonline_parte_iii_seguranca_jwt_autorizacao_por_papeis_e_testes_100_verdes.html">
    <meta property="og:title" content="Csonline – Parte Iii - Segurança Jwt Autorização Por Papéis E Testes 100 Verdes">
    <meta property="og:description" content="Artigo técnico sobre csonline – parte iii - segurança jwt autorização por papéis e testes 100 verdes">
    <meta property="og:image" content="https://chmulato.dev/img/2025_08_09_csonline_parte_iii_seguranca_jwt_autorizacao_por_papeis_e_testes_100_verdes_featured.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://chmulato.dev/articles/2025_08_09_csonline_parte_iii_seguranca_jwt_autorizacao_por_papeis_e_testes_100_verdes.html">
    <meta property="twitter:title" content="Csonline – Parte Iii - Segurança Jwt Autorização Por Papéis E Testes 100 Verdes">
    <meta property="twitter:description" content="Artigo técnico sobre csonline – parte iii - segurança jwt autorização por papéis e testes 100 verdes">
    <meta property="twitter:image" content="https://chmulato.dev/img/2025_08_09_csonline_parte_iii_seguranca_jwt_autorizacao_por_papeis_e_testes_100_verdes_featured.jpg">
    
    <title>Csonline – Parte Iii - Segurança Jwt Autorização Por Papéis E Testes 100 Verdes | Christian Mulato Dev Blog</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="../assets/css/article.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="../assets/js/article.js" defer></script>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="nav-container">
                <a href="../index.html" class="nav-logo">
                    <span class="logo-text">Christian Mulato</span>
                    <span class="logo-subtitle">Dev Blog</span>
                </a>
                
                <div class="nav-links">
                    <a href="../index.html" class="nav-link">Artigos</a>
                    <a href="https://www.linkedin.com/in/chmulato/" class="nav-link" target="_blank">LinkedIn</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="main">
        <article class="article">
            <header class="article-header">
                <div class="article-meta">
                    <span class="article-category">Java & Spring</span>
                    <time class="article-date" datetime="09/08/2025">09/08/2025</time>
                </div>
                
                <h1 class="article-title">Csonline – Parte Iii - Segurança Jwt Autorização Por Papéis E Testes 100 Verdes</h1>
                
                <div class="article-info">
                    <span class="article-author">Por Christian Mulato</span>
                    <div class="article-tags"><span class="tag">Java</span> <span class="tag">Spring</span> <span class="tag">Docker</span> <span class="tag">APIs</span> <span class="tag">Testes</span> <span class="tag">DevOps</span></div>
                </div>
            </header>
            
            <div class="article-content">
                <h1 id="csonline-parte-iii-seguranca-jwt-autorizacao-por-papeis-e-testes-100-verdes"><a class="toclink" href="#csonline-parte-iii-seguranca-jwt-autorizacao-por-papeis-e-testes-100-verdes">Csonline – Parte Iii - Segurança Jwt Autorização Por Papéis E Testes 100 Verdes</a></h1>
<p><img alt="Evolução da aplicação CSOnline - Gestão de Centro de Distribuição (CDs)" src="img/image_not_found.png" /></p>
<p>Evolução da aplicação CSOnline - Gestão de Centro de Distribuição (CDs)</p>
<p><strong>CSOnline – Parte III: Segurança JWT, Autorização por Papéis e Testes 100% Verdes</strong></p>
<p><strong><a href="https://www.linkedin.com/in/chmulato/"><img alt="Christian Mulato, #OPEN_TO_WORK" src="img/image_not_found.png" /></a></strong></p>
<p><strong><a href="https://www.linkedin.com/in/chmulato/">Christian Mulato </a></strong></p>
<p>Desenvolvedor Java Sênior | Especialista em Back-end | Jakarta, Spring Boot, REST APIs, Docker | Engenheiro Químico</p>
<p>9 de agosto de 2025</p>
<p><strong>O que evoluiu nesta fase</strong></p>
<p>Nesta terceira etapa avançamos em segurança, qualidade e preparo para a integração total do <strong><em>frontend </em>Vue __com o </strong><em>backend </em>Jakarta EE__. O sistema agora possui autenticação JWT robusta, autorização por papéis coerente nos endpoints, suíte de testes completa e scripts de desenvolvimento mais amigáveis.</p>
<p>Principais destaques:</p>
<ul>
<li>Segurança ponta a ponta com <strong>JWT </strong>(autenticação) e autorização por papéis (@RolesAllowed)</li>
<li>Matriz de permissões alinhada aos casos de uso reais (<strong>ADMIN, BUSINESS, COURIER, CUSTOMER</strong>)</li>
<li>Testes de controladores, serviços e repositórios estabilizados (<strong>191 testes passando</strong>)</li>
<li>Ambiente de testes isolado (test.mode), base limpa por execução e Jackson registrado</li>
<li>Endpoint de envio de SMS dedicado e ajustes finos em regras de acesso</li>
<li>Prontos para integrar o SPA em __Vue __com os endpoints REST e tokens JWT</li>
</ul>
<p><strong>Segurança: autenticação e autorização</strong></p>
<ul>
<li>Implementamos um filtro de autenticação JWT (<strong><em>JwtAuthenticationFilter</em></strong>) que valida o token do header Authorization e propaga para o contexto os dados do usuário (login, role, id).</li>
<li>Criamos um filtro de autorização (<strong><em>AuthorizationFilter</em></strong>) que lê as anotações @RolesAllowed nos recursos e aplica a decisão com base no papel do usuário autenticado.</li>
<li>
<p>Ajustamos as anotações de segurança nos controladores para refletir a regra de negócio:</p>
</li>
<li>
<p><strong>Users:</strong> criação, atualização e exclusão restritas a ADMIN</p>
</li>
<li>__Teams: __atualização e exclusão restritas a ADMIN</li>
<li><strong>Prices:</strong> listagem por business permitida a ADMIN e BUSINESS</li>
<li><strong>SMS:</strong> deleção e busca por entrega restritas a ADMIN e BUSINESS; novo POST /sms/{id}/send</li>
</ul>
<p><strong>Resultado:</strong> respostas 401 e 403 passaram a refletir corretamente a ausência de token ou falta de permissão, e as operações válidas retornam 2xx como esperado.</p>
<p><strong>Testes: cobertura confiável do backend</strong></p>
<ul>
<li><em>BaseControllerJerseyTest </em>ativa o modo de teste (test.mode) e garante limpeza da base entre cenários, evitando interferência entre casos.</li>
<li>Reescrevemos e ampliamos os testes dos módulos Price (repository/service/controller), além de padronizar os de Courier, Customer, Delivery, SMS, Team e User para sempre enviar os headers de autorização corretos.</li>
<li>Resolvemos falhas pontuais (401/403/415/400/500) com ajustes em headers, content-type e alinhamento de payloads.</li>
<li>Estado atual: 191 testes, todos passando, garantindo estabilidade para a próxima fase.</li>
</ul>
<p><strong>DX e automação</strong></p>
<ul>
<li>Scripts PowerShell simplificam o ciclo de desenvolvimento (build, deploy no <strong>WildFly 31</strong>, testes e verificação de saúde).</li>
<li>Logs mais claros com __Log4j2 __ajudam no diagnóstico durante os testes.</li>
<li>Documentação atualizada para orientar a configuração de ambiente e execução.</li>
</ul>
<p><strong>Integração Frontend (Vue) ↔ Backend (Jakarta)</strong></p>
<p>Com a segurança e os contratos estabilizados, o próximo passo é ligar o __SPA __em __Vue __aos endpoints REST com JWT:</p>
<ul>
<li>Cliente HTTP com injeção automática do token JWT</li>
<li>Tratamento padronizado de erros 401/403 no frontend (ex.: redireciono ao login/avisos de permissão)</li>
<li>Guards de rota por papel (ADMIN, BUSINESS, COURIER, CUSTOMER)</li>
<li>Habilitar CORS conforme necessário e mapear escopos de cada módulo (Users, Teams, Deliveries, SMS, Prices)</li>
</ul>
<p><strong>Como contribuir</strong></p>
<ul>
<li><strong>Frontend:</strong> integrar telas ao <em>backend</em>, melhorar UX/UI, criar guards por papel, estados vazios e feedbacks.</li>
<li><strong>Backend:</strong> refinar validações, paginação/ordenação de listagens, monitoramento e métricas.</li>
<li><strong>QA:</strong> cenários E2E (Cypress/Playwright) para fluxos críticos de autenticação e autorização.</li>
<li><strong>DevOps:</strong> pipelines de CI/CD e empacotamento para ambientes (<strong>dev/homolog/prod</strong>).</li>
</ul>
<p>Faça um fork do repositório em <a href="https://github.com/chmulato/csonline"><strong>https://github.com/chmulato/csonline</strong></a> e confira a documentação em <strong>doc/INDEX.md</strong>. Pull Requests são bem-vindos!</p>
            </div>
            
            <footer class="article-footer">
                <div class="article-author-bio">
                    <h3>Sobre o Autor</h3>
                    <p><strong>Christian Mulato</strong> é Desenvolvedor Java Sênior especializado em arquiteturas escaláveis e microsserviços. 
                    Com experiência em Spring Boot, Docker, APIs REST e sistemas distribuídos.</p>
                    <a href="https://www.linkedin.com/in/chmulato/" target="_blank" class="author-link">
                        Conecte-se no LinkedIn
                    </a>
                </div>
                
                <div class="article-navigation">
                    <a href="../index.html" class="back-link">← Voltar aos artigos</a>
                </div>
            </footer>
        </article>
    </main>
    
    <footer class="site-footer">
        <div class="footer-container">
            <p>&copy; 2025 Christian Mulato. Todos os direitos reservados.</p>
        </div>
    </footer>
</body>
</html>